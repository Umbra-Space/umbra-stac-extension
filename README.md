# Umbra Extension Specification

- **Title:** Umbra
- **Identifier:** <[https://umbra-space.github.io/umbra-stac-extension/json-schema/v1.0.0/schema.json](https://umbra-space.github.io/umbra-stac-extension/json-schema/v1.0.0/schema.json)>
- **Field Name Prefix:** umbra
- **Scope:** Item, Collection
- **Extension [Maturity Classification](https://github.com/radiantearth/stac-spec/tree/master/extensions/README.md#extension-maturity):** Proposal
- **Owner**: @davidraleigh-umbra @pcaisse-umbra

This document explains the Umbra Extension to the [SpatioTemporal Asset Catalog](https://github.com/radiantearth/stac-spec) (STAC) specification. 
This document describes fields of metadata for users of the [Umbra Space](https://umbra.space) task and collect metadata.

In addition to this umbra STAC extension, Umbra STAC metadata includes the [`sat` extension](https://github.com/stac-extensions/sat), 
the [`sar` extension](https://github.com/stac-extensions/sar), the [`view` extension](https://github.com/stac-extensions/view) and the [`processing` extension](https://github.com/stac-extensions/processing).

- Examples:
  - [Item example](examples/item.json): Shows the basic usage of the extension in a STAC Item
- [JSON Schema](json-schema/v1.0.0/schema.json)
- [Changelog](./CHANGELOG.md)

## Fields

### Umbra Specific Fields

The fields in the table below can be used in these parts of STAC documents:

- [ ] Catalogs
- [ ] Collections
- [x] Item Properties (incl. Summaries in Collections)
- [ ] Assets (for both Collections and Items, incl. Item Asset Definitions in Collections)
- [ ] Links

The below table of definitions are for Umbra specific STAC Item metadata.

| Field Name                               | Type   | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|------------------------------------------|--------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| umbra:best_resolution_azimuth_meters     | number | The best possible azimuth resolution achievable from the CPHD data product processing.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| umbra:best_resolution_range_meters       | number | The best possible range resolution achievable from the CPHD data product processing.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| umbra:collect_id                         | UUID   | The collect id if the task is composed of a single collect for the task. [Umbra Collect docs](https://docs.canopy.umbra.space/docs/tasking#collects)                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| umbra:collect_ids                        | [UUID] | The collect ids if the task is composed of multiple collects for the task. [Umbra Collect docs](https://docs.canopy.umbra.space/docs/tasking#collects)                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| umbra:grazing_angle_degrees              | number | The angle between the local vertical and the line of sight. It is a complement to the incidence angle (they always add up to 90&deg;). It determines how steep (or shallow) the angle of collection is. As a general rule, a higher grazing angle provides more image contrast but reduces the amount of access to the AOI.                                                                                                                                                                                                                                                                                                  |
| umbra:organization_id                    | string | The umbra provided organization id for the task. ORG ID in [Canopy organization overview](https://canopy.umbra.space/organization)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| umbra:platform_pair                      | string | Only defined in the case where `"sar:instrument_mode" == "MULTISTATIC"`. Unique name of the Umbra satellite which transmitted pulse data to the Umbra satellite defined by the `platform` property in a multistatic collect. The following [regex](https://regex101.com/r/fHKrGm/2) defines the usable platform strings: `Umbra-[\d]{2,}+`. For example `"Umbra-09"` is viable Umbra platform name, but `"Umbra9"`, `"Umbra09"`, `"umbra-09"`, `"UMBRA-09"`, and `"Umbra_09"` are all invalid. Defintion from [common metadata](https://github.com/radiantearth/stac-spec/blob/v1.0.0/item-spec/common-metadata.md#platform) |
| umbra:slant_range_meters                 | number | The Slant Range is the straight line distance between the target location and the satellite in meters.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       |
| umbra:squint_angle_degrees_off_broadside | number | 90&deg; is in the direction of the velocity vector for both left and right observation directions. 90&deg; is also in the direction opposite of the velocity vector. 0&deg; is off broadside for both left and right observation directions. ![degrees_off_broadside_squint](images/degrees_off_broadside_squint.png)                                                                                                                                                                                                                                                                                                        |
| umbra:squint_angle_engineering_degrees   | number | 0&deg; signifies the satellite's velocity vector - a reference point for orientation determination. Negative is to the left of vehicle and positive to the right. 180&deg;/-180&deg; is the opposite direction of the velocity vector. ![engineering](images/engineering_squint.png)                                                                                                                                                                                                                                                                                                                                         |
| umbra:squint_angle_exploitation_degrees  | number | On the right side of vehicle, -90&deg; is velocity vector direction, 0&deg; broadside and 90&deg; opposite of velocity vector. on Left side 90&deg; is velocity vector direction, 0&deg; broadside and -90&deg; opposite to velocity vector. To be used in conjunction with [sar extension](https://github.com/stac-extensions/sar/tree/v1.0.0?tab=readme-ov-file#item-properties) `sar:observation_direction` to determine `"left"` and `"right"` antenna pointing direction.  ![exploitation](images/exploitation_squint.png)                                                                                              |
| umbra:target_azimuth_angle_degrees       | number | The angle between the projected vector [the collection geometry of the particular opportunity] and a reference vector [north] on the reference plane is called the azimuth. This identifies the direction from which the capture will occur. As an example, a target azimuth angle of 90 degrees means the satellite will be due looking due west at the target from a position due east of the target.                                                                                                                                                                                                                      |
| umbra:task_id                            | UUID   | **REQUIRED**. The task id. [Umbra Task docs](https://docs.canopy.umbra.space/docs/tasking#tasks)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |

### Interpretation of STAC Common Fields

For the fundamental STAC Item fields, Umbra provides additional information on how we utilize the [common metadata](https://github.com/radiantearth/stac-spec/blob/v1.0.0/item-spec/common-metadata.md). 
There is a STAC Item per processing job at Umbra, which means one task/collect could have multiple STAC Items. For the most part, 
there is a one-to-one relationship between tasks and STAC Items.

The STAC version supported by Umbra is 1.0.0 (`"stac_version": "1.0.0"`). The currently supported `"stac_extension"` field will be :
```json
  "stac_extensions" : [
    "https://stac-extensions.github.io/processing/v1.0.0/schema.json",
    "https://stac-extensions.github.io/sar/v1.0.0/schema.json",
    "https://stac-extensions.github.io/sat/v1.0.0/schema.json",
    "https://stac-extensions.github.io/view/v1.0.0/schema.json"
  ]
```

If there are any other common metadata fields not listed below, then those fields are either not currently supported in Umbra's STAC Item or 
they exactly follow the definitions from STAC [item-spec](https://github.com/radiantearth/stac-spec/blob/v1.0.0/item-spec/item-spec.md) and [common-metadata](https://github.com/radiantearth/stac-spec/blob/v1.0.0/item-spec/common-metadata.md).

| Field Name     | Type                                                                                                                  | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|----------------|-----------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| id             | UUID                                                                                                                  | A single `umbra:task_id` or `umbra:collect_id` can have multiple STAC Items. The `id` field of the STAC Item at Umbra is associated with the processing of a task/collect (prior to Dec, 2024, the `id` was not associated with the processing of an task, but instead the `id` was randomly generated). One collect can be processed multiple times, each time it's processed with new parameters a STAC Item will be created and the processing id will be the used as the STAC Item `id`                                                                                                                                                                                   |
| created        | string                                                                                                                | Typically the date and time at the completion of processing of the data (although there may be collects whose metadata is not associated with the processing date because of some fix to metadata). It is formatted according to [RFC 3339, section 5.6](https://tools.ietf.org/html/rfc3339#section-5.6). Definition from [common metadata](https://github.com/radiantearth/stac-spec/blob/v1.0.0/item-spec/common-metadata.md#date-and-time).                                                                                                                                                                                                                               |
| updated        | string                                                                                                                | The date and time of the last update to STAC metadata. It is formatted according to [RFC 3339, section 5.6](https://tools.ietf.org/html/rfc3339#section-5.6). Definition from [common metadata](https://github.com/radiantearth/stac-spec/blob/v1.0.0/item-spec/common-metadata.md#date-and-time).                                                                                                                                                                                                                                                                                                                                                                            |
| datetime       | string                                                                                                                | The center date and time of the collect, which must be in UTC. It is formatted according to [RFC 3339, section 5.6](https://tools.ietf.org/html/rfc3339#section-5.6). Definition from [common metadata](https://github.com/radiantearth/stac-spec/blob/v1.0.0/item-spec/item-spec.md#properties-object).                                                                                                                                                                                                                                                                                                                                                                      |
| start_datetime | string                                                                                                                | The start date and time associated with the first pulse of the task, in UTC. It is formatted according to [RFC 3339, section 5.6](https://tools.ietf.org/html/rfc3339#section-5.6).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
| end_datetime   | string                                                                                                                | The end date and time associated with the last pulse of the task, in UTC. It is formatted according to [RFC 3339, section 5.6](https://tools.ietf.org/html/rfc3339#section-5.6).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |
| platform       | string                                                                                                                | Unique name of the specific Umbra satellite which received the pulse data. In the case of `"sar:instrument_mode" == "MULTISTATIC"`, the Umbra satellite receiving data is defined by `platform` and the satellite transmitting is defined by the `umbra:platform_pair` field. The following [regex](https://regex101.com/r/fHKrGm/2) defines the usable platform strings: `Umbra-[\d]{2,}+`. For example `"Umbra-09"` is viable Umbra platform name, but `"Umbra9"`, `"Umbra09"`, `"umbra-09"`, `"UMBRA-09"`, and `"Umbra_09"` are all invalid. Defintion from [common metadata](https://github.com/radiantearth/stac-spec/blob/v1.0.0/item-spec/common-metadata.md#platform) |
| constellation  | string                                                                                                                | Name of the constellation to which the platform belongs. Always set to `"umbra"`. Definition from [common metadata](https://github.com/radiantearth/stac-spec/blob/v1.0.0/item-spec/common-metadata.md#constellation)                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| providers      | [Provider Object](https://github.com/radiantearth/stac-spec/blob/v1.0.0/item-spec/common-metadata.md#provider-object) | Additional information about [Umbra](https://umbra.space). Definition from [common metadata](https://github.com/radiantearth/stac-spec/blob/v1.0.0/item-spec/common-metadata.md#provider)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| geometry       | [GeoJSON Geometry Object](https://tools.ietf.org/html/rfc7946#section-3.1)                                            | Defines the full footprint of the collect(s) of the STAC Item's task represented by this Item, formatted according to [RFC 7946, section 3.1](https://tools.ietf.org/html/rfc7946#section-3.1). The footprint should be the default GeoJSON geometry, though additional geometries can be included. Coordinates are specified in Longitude/Latitude or Longitude/Latitude/Elevation based on [WGS 84](http://www.opengis.net/def/crs/OGC/1.3/CRS84). If elevation is included it's in meters relative to WGS 84.                                                                                                                                                              |
| bbox           | [number]                                                                                                              | Bounding Box of the task. 4 floats that define the bounding box are formatted as follows, [minimum longitude, minimum latitude, maximum longitude, maximum latitude]. Formatted according to [RFC 7946, section 5](https://tools.ietf.org/html/rfc7946#section-5).                                                                                                                                                                                                                                                                                                                                                                                                            |

### Fields From Other Extensions

The following other extensions are used along with the above fields for an Umbra STAC Item
- <https://github.com/stac-extensions/processing/tree/v1.0.0>
- <https://github.com/stac-extensions/sar/tree/v1.0.0>
- <https://github.com/stac-extensions/sat/tree/v1.0.0>
- <https://github.com/stac-extensions/view/tree/v1.0.0>

Of the above listed extensions the following fields are utilized by Umbra

| Field Name                | Type                | Description                                                                                                                                                                                                                        |
|---------------------------|---------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| processing:software       | Map<string, string> | A dictionary with name/version of the Umbra processing library involved during the production of the data for provenance purposes.                                                                                                 |
| sar:center_frequency      | number              | The center frequency of the instrument, in gigahertz (GHz).                                                                                                                                                                        |
| sar:frequency_band        | string              | **REQUIRED.** For Umbra this will always be the `"X"` band. [common frequency band names and definitions](https://github.com/stac-extensions/sar/tree/v1.0.0?tab=readme-ov-file#common-frequency-band-names)                       |
| sar:instrument_mode       | string              | **REQUIRED.** The name of the sensor acquisition mode that is commonly used. For example, `"SPOTLIGHT"` for Umbra [spotlight collect](https://docs.canopy.umbra.space/docs/tasking#tasks) or `"MULTISTATIC"` for multistatic tasks |
| sar:looks_azimuth         | number              | Number of azimuth looks, which is the number of groups of signal samples (looks) parallel to the flight path.                                                                                                                      |
| sar:looks_range           | number              | Number of range looks, which is the number of groups of signal samples (looks) perpendicular to the flight path. Umbra satellites do not perform range multi-looking so this is always 1 for now.                                  |
| sar:observation_direction | string              | Antenna pointing direction relative to the flight trajectory of the satellite, either `"left"` or `"right"`.                                                                                                                       |
| sar:polarizations         | \[string]           | **REQUIRED.** Any combination of polarizations. `"VV"`, `"HH"`, or `"SS"` (slant).                                                                                                                                                 |
| sar:product_type          | string              | ***DEPRECATED** in favor of [`product:type`](https://github.com/stac-extensions/product).* For Umbra this will always be `"GEC"`                                                                                                   |
| sar:resolution_azimuth    | number              | The azimuth resolution, which is the maximum ability to distinguish two adjacent targets parallel to the flight path, in meters (m).                                                                                               |
| sar:resolution_range      | number              | The range resolution, which is the maximum ability to distinguish two adjacent targets perpendicular to the flight path, in meters (m).                                                                                            |
| sat:orbit_state           | string              | The state of the orbit. Either `"ascending"` or `"descending"`                                                                                                                                                                     |
| view:azimuth              | number              | Viewing azimuth angle. The angle measured from the sub-satellite point (point on the ground below the platform) between the scene center and true north. Measured clockwise from north in degrees (0-360).                         |
| view:incidence_angle      | number              | The incidence angle is the angle between the vertical (normal) to the intercepting surface and the line of sight back to the satellite at the scene center. Measured in degrees (0-90).                                            |

### Additional Field Information

Diagram demonstrating difference between `umbra:squint_angle_engineering_degrees`, `umbra:squint_angle_exploitation_degrees`, and `umbra:squint_angle_degrees_off_broadside`:
![squints](images/squints.png)

More details on squint [here](https://docs.canopy.umbra.space/docs/squint):

### Deprecated field

| Field Name                 | Type   | Description                                        |
|----------------------------|--------|----------------------------------------------------|
| umbra:squint_angle_degrees | number | replaced by umbra:squint_angle_engineering_degrees |

### Running tests

The same checks that run as checks on PR's are part of the repository and can be run locally to verify that changes are valid. 
To run tests locally, you'll need `npm`, which is a standard part of any [node.js installation](https://nodejs.org/en/download/).

First you'll need to install everything with npm once. Just navigate to the root of this repository and on 
your command line run:
```bash
npm install
```

Then to check markdown formatting and test the examples against the JSON schema, you can run:
```bash
npm test
```

This will spit out the same texts that you see online, and you can then go and fix your markdown or examples.

If the tests reveal formatting problems with the examples, you can fix them with:
```bash
npm run format-examples
```
